class PlayWhat {
	static oGames = oGamesData;
	static iLength = oGamesData.length;
	static iTheMaxCount = 0;
	static iTheMaxIndex = "";
	static aTmp = new Array();
	static iRT = -1;
	static fRunTimes = performance.now();
	
	static iRound = 0;
	static iInTM = 0;
	static iInRMS = 0;
	static iInDV = 0;
	static iInMAD = 0;
	static iInSD = 0;
	static iInRT = 0;
	
	static init() {
		if ($('#nu').val() == '' || $('#nu').val() < 1) {
			this.iRound = (this.iLength * 10000);
			$('#nu').val(this.iRound);
		}
		else {
			this.iRound = $('#nu').val();
		}
		
		if ($('#TM_in').val() == '' || $('#TM_in').val() < 1) {
			this.iInTM = 10000;
			$('#TM_in').val(this.iInTM);
		}
		else {
			this.iInTM = $('#TM_in').val();
		}
		
		if ($('#RMS_in').val() == '' || $('#RMS_in').val() < 1) {
			this.iInRMS = this.iRound / this.iLength * 1.1;
			$('#RMS_in').val(this.iInRMS);
		}
		else {
			this.iInRMS = $('#RMS_in').val();
		}
		
		if ($('#DV_in').val() == '' || $('#DV_in').val() < 1) {
			this.iInDV = this.iRound;
			$('#DV_in').val(this.iInDV);
		}
		else {
			this.iInDV = $('#DV_in').val();
		}
		
		if ($('#MAD_in').val() == '' || $('#MAD_in').val() < 1) {
			this.iInMAD = this.iRound / this.iLength;
			$('#MAD_in').val(this.iInMAD);

		}
		else {
			this.iInMAD = $('#MAD_in').val();
		}
		
		if ($('#SD_in').val() == '' || $('#SD_in').val() < 1) {
			this.iInSD = this.iRound / this.iLength;
			$('#SD_in').val(this.iInSD);
		}
		else {
			this.iInSD = $('#SD_in').val();
		}
		
		if ($('#RT_in').val() == '' || $('#RT_in').val() < 0) {
			this.iInRT = 5000;
			$('#RT_in').val(this.iInRT);
		}
		else {
			this.iInRT = $('#RT_in').val();
		}
	}
	
	static fRMS() {
				var iii = 0;
				this.aTmp.forEach((num) => {
					iii += num * num;
				});
				iii = math.sqrt(iii / (this.iLength));
				return iii;
	}
	
	static fOutput() {
		this.oGames.sort(function(a, b){return b.counts - a.counts});
		
		$("#tb2").empty();
		for (var k = 0; k < this.iLength; k = k + 1) {
			$("#tb2").append("<tr><td><img alt=\"" +
			this.oGames[k].xxxx + "\" src=\"img/" +
			this.oGames[k].xxxx + ".png\"></img></td><td><h1>" +
			this.oGames[k].name + "</h1></td><td><h2></h2></td></tr>");
		}
		
		$('#tb2 tr').css("background-color", 'lightgrey');
	
		for (var j = 0; j < this.iLength; j = j + 1) {
			if(this.oGames[j].counts > this.iTheMaxCount) {
				this.iTheMaxCount = this.oGames[j].counts;
				this.iTheMaxIndex = j;
			}

			$($("#tb2 h2")[j]).html(this.oGames[j].counts);
			$('#tb2 td:nth-child(2)').css("width", '30em');
		}
		
		$('#tb2 tr:nth-child(1)').css("background-color", 'lightcyan');
		
		$('#MAX_data').html(Math.round((math.max(this.aTmp)*100))/100);
		$('#MID_data').html(Math.round((math.median(this.aTmp)*100))/100);
		$('#RMS_data').html(Math.round((this.fRMS()*100))/100);
		$('#DV_data').html(Math.round((math.variance(this.aTmp)*100))/100);
		$('#MIN_data').html(Math.round((math.min(this.aTmp)*100))/100);
		$('#AVG_data').html(Math.round((math.mean(this.aTmp)*100))/100);
		$('#MAD_data').html(Math.round((math.mad(this.aTmp)*100))/100);
		$('#SD_data').html(Math.round((math.std(this.aTmp)*100))/100);
		
		for (var i = 0; i < $('#tb1 div').length; i++) {
			if(parseFloat($($('#tb1 div')[i]).html()) < parseFloat($($('#tb1 input')[i]).val())) {
				$($('#tb1 div')[i]).css('color', 'green');
				$($('#tb1 input')[i]).css('color', 'green');
			}
			else {
				$($('#tb1 div')[i]).css('color', 'black');
				$($('#tb1 input')[i]).css('color', 'black');
			}
		}
		return 0;
	}
	
	static fSTD() {
		// Empty Array
		for (var ii = 0; ii < this.iLength; ii++) {this.aTmp[ii] = 0;}
		do {
			// Random
			for (var i = 0; i < this.iRound; i++) {
				this.aTmp[Math.floor(Math.random() * this.iLength)] += 1;

				if(performance.now() - this.fRunTimes > this.iInTM){break;}
			}
			this.iRT += 1;
			
			if(this.iRT > this.iInRT - 1){break;}
		} while (
			this.fRMS() > this.iInRMS ||
			math.variance(this.aTmp) > this.iInDV ||
			math.mad(this.aTmp) > this.iInAD ||
			math.std(this.aTmp) > this.iInSD
		)
		
		for (var r = 0; r < this.iLength; r = r + 1) {
			this.oGames[r].counts = this.aTmp[r];
		}
		
		$('#RT_data').html(this.iRT);
		
		return 0;
	}
	
	static fStart() {
		this.init();
		this.fRunTimes = performance.now();
		this.fSTD();
		this.fOutput();
		
		$('#TM_data').html(Math.round((performance.now() - this.fRunTimes) * 100) / 100);
		
		return 0;
	}
}

document.getElementById("go").focus();

$('#go, #up').on('click', function (){
	contentUpdate();
});

$('input').on('input', function() {
	$(this).val($(this).val().replaceAll(/\D+/gi,''));
	if ($(this).val() == '' || $('#nu').val() < 1) {
		$(this).val(1);
	}
});

$('#nu').on('blur change', function() {
	if ($('#au')[0].checked) {
		contentUpdate();
	}
});

function contentUpdate() {
	PlayWhat.fStart();
	$('#RMS_in').val(PlayWhat.iRound / PlayWhat.iLength * 1.1);
	$('#DV_in').val(PlayWhat.iRound);
	$('#MAD_in').val(PlayWhat.iRound / PlayWhat.iLength);
	$('#SD_in').val(PlayWhat.iRound / PlayWhat.iLength);
}

contentUpdate();